{% extends 'account/account_base.html' %}
{% load static %}
{% block body %}


 <!--=========================== ACCOUNT DASHBOARD  ========================-->

 <div class="content-wrapper">
    <!-- ============= Login Success Message =======================-->
         
    <div class="d-flex align-items-center justify-content-end ">
     {% if success_msg %}
       <div class="messageBox-container" id="message-container">
       
               <div class="messageicon-Box successBox "><i class="mdi mdi-check icon-sm"></i></div>
               <p class="text-center success-text">{{success_msg}}</p>
       </div>
     {% elif error_msg %}
       <div class="messageBox-container" id="message-container">
               <div class="messageicon-Box errorBox "><i class="mdi mdi-close icon-sm"></i></div>
               <p class="text-center error-text">{{error_msg}}</p>
       </div>
     {% endif %}
   </div>
    

   <!---=================================================================-->

   <!-- ======================= Main Section =============================-->


   
   <div class="row">
     <div class="col-sm-12">
       <div class="home-tab">

         <div class="tab-content tab-content-basic">
           <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview"> 
             <div class="row">
               <div class="col-md-3 grid-margin stretch-card">
                 <a href="#">
                     <div class="card">
                     <div class="card-body">
                         <h4 class="card-title">Onthe Job Training  - ({{reg_count}})</h4>
                         <div class="media">
                         <i class="mdi mdi-account-check icon-md text-info d-flex align-self-start me-3"></i>
                         <div class="media-body">
                             <p class="card-text"> Providing the details of OJT members </p>
                         </div>
                         </div>
                     </div>
                     </div>
                 </a>
               </div>
               <div class="col-md-3 grid-margin stretch-card">
                <a href="{% url 'pyment_form' %}">
                    <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Add OJT Payments </h4>
                        <div class="media">
                        <i class="mdi mdi-plus-circle-outline icon-md text-info d-flex align-self-end me-3"></i>
                        <div class="media-body">
                            <p class="card-text">To add  OJT payments from members </p>
                        </div>
                        </div>
                    </div>
                    </div>
                </a>
              </div>
               <div class="col-md-3 grid-margin stretch-card">
                 <a href="#">
                     <div class="card">
                     <div class="card-body">
                         <h4 class="card-title">Employees - ({{emp_reg}})</h4>
                         <div class="media">
                         <i class="mdi mdi-account-multiple icon-md text-info d-flex align-self-center me-3"></i>
                         <div class="media-body">
                             <p class="card-text">The details of Employees in {{acc_state.state_name}} state.</p>
                         </div>
                         </div>
                     </div>
                     </div>
                 </a>
               </div>
               <div class="col-md-3 grid-margin stretch-card">
                <a href="#">
                    <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Employees Salary</h4>
                        <div class="media">
                        <i class="mdi mdi-account-multiple icon-md text-info d-flex align-self-center me-3"></i>
                        <div class="media-body">
                            <p class="card-text">Providing the salary details of employees </p>
                        </div>
                        </div>
                    </div>
                    </div>
                </a>
              </div>
               
             </div>
          
             <div class="row">
               <div class="col-lg-12 d-flex flex-column">
               
                 <div class="row flex-grow">
                   <div class="col-12 grid-margin stretch-card">
                     <div class="card card-rounded">
                       <div class="card-body">
                         <div class="d-sm-flex justify-content-between align-items-start">
                           <div>
                             <h4 class="card-title card-title-dash">Payment List</h4>
                            <p class="card-subtitle card-subtitle-dash">You have <span class="count-value">{{approve_count}}</span> new requests</p>
                           </div>
                           {% if new_reg %}
                           <div>
                             <a href="{% url 'newpay_confirm_list' %}"><button type="button" class="btn btn-primary btn-lg text-white mb-0 me-0 blink" type="button"><i class="mdi mdi-account-plus "></i>OJT- New Registrations( {{new_reg}} )</button></a>
                           </div>
                           {% endif %}
                           
                         </div>
                         <div class="table-responsive  mt-1">
                           <table class="table select-table">
                             <thead>
                               <tr>
                                    <th>Edit</th>  
                                    <th>Full Name</th>
                                    <th>Msg</th>
                                    <th>Next Pay AMT</th>
                                    <th>DOF-Join</th>
                                    <th>Reff.</th>
                                    <th>Dept.</th>
                                    <th>TL Paid</th>
                                    <th>BAL. amt</th>
                                    <th>TL. amt</th>
                                    <th>Progress</th>
                                    <th class="text-center">Status</th>
                               </tr>
                             </thead>
                             <tbody>
                             {% for i in reg %}
                               <tr>
                               
                                 <td>
                                   <div>
                                     <div class="btn-wrapper">
                                        
                                       <a href="{% url 'singleuser_details' i.id %}" class=" text-primary me-0"><i class="mdi mdi-pen"></i> Edit</a>
                                     </div>
                                   </div>
                                 </td>
                                 
                                 <td>
                                   <div class="d-flex ">
                                     <div>{{i.fullName}}</div>
                                   </div>
                                 </td>
                                 <td>{{i.next_pay_date}}</td>
                                 <td>{{i.next_pat_amt}}</td>
                                 <td>{{i.dofj}}</td>
                                 <td>{{i.refrence}}</td>
                                 <td>{{i.dept_id.department}}</td>
                                 <td>{{i.reg_payedtotal}}</td>
                                 <td>{{i.regbalance_amt}}</td>
                                 <td>{{i.regtotal_amt}}</td>
                                 <td>
                                    <div class="progress progress-md">
                                        <div class="progress-bar bg-success" role="progressbar" style="width:{{i.payprogress}}%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                 </td>

                                 <td><div class="badge badge-opacity-warning">wating for approve</div></td>
                               </tr>
                               {% endfor %}
                               
                             </tbody>
                           </table>
                         </div>
                       </div>
                     </div>
                   </div>
                 </div>
                
               </div>
              
             </div>

           </div>
         </div>
       </div>
     </div>
   </div>

   <!---=================================================================-->
 </div>

 <!-- content-wrapper ends -->




{% endblock %}






<!--Container Main start-->
<main>

{% if content.msg_succes == 1 %}
<div class="welcome_messagebox" id="msgbox">
    <div class="msg-box">
        <p><i class="bi bi-person-check-fill"></i> Login Successfull...</p>
    </div>
</div>
{% endif %}

<div class="container-fluid" id="action-box">
    <a href="{% url 'analysis' %}">
        <div class="card">
            <i class="bi bi-graph-up-arrow"></i><h5>Analysis</h5>
            
        </div>
    </a>

    <a href="{% url 'Register_form' %}">
       
        <div class="card">
            <i class='bi bi-people-fill nav_icon'></i><h5>Register</h5>
            <div class="nofication">
                <span>{{content.reg_count}}</span>
            </div>
        </div>
    </a>
    <a href="{% url 'pyment_form' %}">
        <div class="card">
            <i class="bi bi-currency-rupee"></i><h5>Add Payments</h5>
            <div class="nofication">
                <span>{{content.pay_pending_count}}</span>
            </div>
        </div>
    </a>
    <a href="{% url 'track_payments' %}">
        <div class="card">
            <i class="bi bi-search"></i><h5>Track Payments</h5>
            <div class="nofication">
                <span>{{content.pay_count}}</span>
            </div>
        </div>
    </a>
    <a href="{% url 'pyments_history' %}">
        <div class="card">
            <i class="bi bi-database-fill-add"></i><h5>Payments History</h5>
        </div>
    </a>
    <a href="{% url 'department_form' %}">
        <div class="card">
            <i class="bi bi-box-fill"></i><h5>Department</h5>
            <div class="nofication">
                <span>{{content.dept_count}}</span>
            </div>
        </div>
    </a>
    <a href="{% url 'accounts' %}">
        <div class="card">
            <i class="bi bi-cash"></i><h5>Accounts</h5>
            
        </div>
    </a>
</div>
<!--Container Main end-->




<!-- Register-list Style -->

<!--Container List Show-->
<div class="container-fluid" id="register-list">
    <div class="head-btnBox">
        <div class="pay-head">
            <h5> PAYMENT LIST</h5>
        </div>
        <div class="pay-search">
          

            <form action="{% url 'Search_data' %}" method="post" id="serach-date">

                {% csrf_token %}
                <div class="search-box">
                
                    <div class="input-date-box">
                       
                        <input type="date" name="fr_data" required data-bs-toggle="tooltip" data-bs-placement="top"
                        data-bs-custom-class="custom-tooltip"
                        data-bs-title="From Date">
                    </div>
                    <div class="input-date-box">
                        <input type="date" name="to_date" required >
                    </div>
                    <div class="submit-box">
                        <button type="submit"><i class="bi bi-search"></i> </button>
                    </div>
                </div>
            </form>

        </div>
    </div>
    
       
        {% if msg == 1 %}
            <div class="message-bx" id="msgbox">
                <p><i class="bi bi-check"></i>Payments All Completed </p>
            </div>
        {% endif %}
        {% if msgalert %}
            <div class="msgbox-deactive" id="msgbox">
                <p style="margin-top: 0.40em;"><i class="bi bi-check"></i> {{msgalert}}</p>
            </div>
        {% endif %}
        <table id="register-details" class="display" >
            <thead>
                <tr>
                    <th></th>
                    <th>Full Name</th>
                    <th>Message</th>
                    <th>Next Pay AMT</th>
                    <th>Date Of Joing</th>
                    <th>Referenced By</th>
                    <th>Department</th>
                    <th>TL Paid</th>
                    <th>BAL Amount</th>
                    <th>TL Amount</th>
                    <th> Pay Progress</th>
                    <th>Status</th>

                </tr>
            </thead>
            <tbody>
                {% for i in reg %}
                {% if i.payprogress >= 10 and i.payment_status == 0 %}
                    <tr >
                        <td>
                            {{ forloop.counter }}
                        
                        <a href="{% url 'singleuser_details' i.id %}" class="edit"><i class="bi bi-pen-fill"></i></a> 
                           
                        </td>
                        {% if cur_date < i.next_pay_date %}
                        <td class="warning">{{i.fullName}}</td>
                        <td class="successmsg warning">
                            <span >Next Payment On {{ i.next_pay_date}} </span>
                        </td>
                        {% elif cur_date > i.next_pay_date %}
                        <td class="danger">
                        {{i.fullName}}   
                        </td>
                        <td class="warning">
                            <span class="dangermsg"><i class="bi bi-exclamation-triangle-fill"></i> Payment Date Exceed</span>
                        </td>
                        {% else %}
                        <td class="warning">
                            {{i.fullName}}
                        </td>
                        <td>
                            <span class="warningmsg"><i class="bi bi-exclamation-triangle-fill"></i> Last Date For Payment</span>
                        </td>
                        {% endif %}
                        <td class="warning"> {{i.next_pat_amt}}</td>
                        <td class="warning">{{i.dofj}}</td>
                        <td class="warning">{{i.refrence}}</td>
                        <td class="warning">{{i.dept_id.department}}</td>
                        <td class="warning">{{i.reg_payedtotal}}</td>
                        <td class="warning">{{i.regbalance_amt}}</td>
                        <td class="warning">{{i.regtotal_amt}}</td>
                        <td class="payprogress">
                            <div class="progress">
                                <div class="progress-bar progress-bar-warning" 
                                role="progressbar" style="width: {{i.payprogress}}%;" 
                                aria-valuenow="{{i.payprogress}}" aria-valuemin="0" aria-valuemax="100"> {{i.payprogress}}%

                                </div>
                            </div>
                        </td>
                        <td > <span class="" style="color: #0c376b;font-size:0.92em;font-weight:600;">Active-User</span></td>
                    </tr>

                {% elif  i.payprogress == 100 or i.payment_status == 1 and i.next_pay_date == None  %}

                    <tr >
                        <td>
                            {{ forloop.counter }}
                        
                        <a href="{% url 'singleuser_details' i.id %}" class="edit"><i class="bi bi-pen-fill"></i></a> 
                          
                        </td>
                        <td class="success">{{i.fullName}}</td>
                        <td class="successmsg success">
                            
                            <span style="color: #fff;">Payment All Done.</span>
                           
                        </td>
                        <td class="success"> {{i.next_pat_amt}}</td>
                        <td class="success">{{i.dofj}}</td>
                        <td class="success">{{i.refrence}}</td>
                        <td class="success">{{i.dept_id.department}}</td>
                        <td class="success">{{i.reg_payedtotal}}</td>
                        <td class="success">{{i.regbalance_amt}}</td>
                        <td class="success">{{i.regtotal_amt}}</td>
                        <td class="payprogress">
                            <div class="progress">
                                <div class="progress-bar progress-bar-success" 
                                role="progressbar" style="width: {{i.payprogress}}%;" 
                                aria-valuenow="{{i.payprogress}}" aria-valuemin="0" aria-valuemax="100"> {{i.payprogress}}%
                            
                                </div>
                            </div>
                        </td>
                        <td class="actiontd  payprogress">
                           
                          
                            <span class="completed"><i class="bi bi-check-circle-fill px-1"></i> Completed</span>
                           
                        </td>
                    </tr>

                {% else %}
                    {% if  i.payment_status == 2 or i.reg_status == 2  %}

                        <tr >
                            <td>
                                {{ forloop.counter }}
                            
                            <a href="{% url 'singleuser_details' i.id %}" class="edit"><i class="bi bi-pen-fill"></i></a> 
                              
                            </td>
                            {% if cur_date > i.next_pay_date %}
                            <td class="danger">
                            {{i.fullName}}   
                            </td>
                            <td>
                                <span class="dangermsg"><i class="bi bi-exclamation-triangle-fill"></i> Payment Date Exceed</span>
                            </td>
                            {% else %}
                            <td class="danger">
                                {{i.fullName}}
                            </td>
                            <td class="danger">
                                <span style="color: #fff;"><i class="bi bi-exclamation-triangle-fill"></i>Payments Not Completed</span>
                            </td>
                            {% endif %}
                            <td class="danger"> {{i.next_pat_amt}}</td>
                            <td class="danger">{{i.dofj}}</td>
                            <td class="danger">{{i.refrence}}</td>
                            <td class="danger">{{i.dept_id.department}}</td>
                            <td class="danger">{{i.reg_payedtotal}}</td>
                            <td class="danger">{{i.regbalance_amt}}</td>
                            <td class="danger">{{i.regtotal_amt}}</td>
                            <td>
                                <div class="progress">
                                    <div class="progress-bar progress-bar-danger" 
                                    role="progressbar" style="width: {{i.payprogress}}%;" 
                                    aria-valuenow="{{i.payprogress}}" aria-valuemin="0" aria-valuemax="100"> {{i.payprogress}}%
                                
                                    </div>
                                </div>
                            </td>
                            <td > <span class="" style="color: #f32424;font-size:0.92em;font-weight:700;">Deactive</span></td>
                        </tr>
                    
                    {% endif %}
                {% endif %}
                {% endfor %}
              
            </tbody>
           
        </table>

    </div>
</div>



</main>



